import{y}from"./preact.module-Cko36Lti.js";import{c as createComponent,F,p,x}from"./create-component-B1Y1oDBF.js";import{g as getCurrentFromRef}from"./get-current-from-ref-J2nPd355.js";import{n as noop}from"./no-op-DX6rZLP_.js";import{c as computeNextValue}from"./compute-next-value-cPEw4eRZ.js";import{i as isKeyCodeCharacterGenerating}from"./is-keycode-character-generating-C88G8DHI.js";import{M as MIXED_STRING,a as MIXED_NUMBER}from"./mixed-values-hkF2bnrF.js";const floatOperandRegex=/^-?\d*(?:\.\d*)?$/,integerOperandRegex=/^-?\d*$/,operatorRegex=/[+\-*/]/,operatorSuffixRegex=/[+\-*/]$/,numbersRegex=/\d/,invalidCharactersRegex=/[^\d.+\-*/]/;function evaluateNumericExpression(value){return value===""||numbersRegex.test(value)===!1||invalidCharactersRegex.test(value)===!0?null:operatorRegex.test(value)===!0?operatorSuffixRegex.test(value)===!0?eval(value.substring(0,value.length-1)):eval(value):parseFloat(value)}function isValidNumericInput(t,n={integersOnly:!1}){const u=(t[0]==="-"?t.substring(1):t).split(operatorRegex);let i=-1;for(;++i<u.length;){const l=u[i];if(l===""&&i!==u.length-1||(n.integersOnly===!0?integerOperandRegex:floatOperandRegex).test(l)===!1)return!1}return!0}const EMPTY_STRING$1="",fractionalPartRegex=/\.([^.]+)/,nonDigitRegex=/[^\d.]/;function formatEvaluatedValue(t,n,u){if(t===null)return EMPTY_STRING$1;const i=countSignificantFigures(nonDigitRegex.test(n)===!0?`${t}`:n);return appendSuffix(formatSignificantFigures(t,i),u)}function countSignificantFigures(t){const n=fractionalPartRegex.exec(t);return n===null?0:n[1].length}function formatSignificantFigures(t,n){if(n===0)return`${t}`;const u=fractionalPartRegex.exec(`${t}`);if(u===null)return`${t}.${"0".repeat(n)}`;const i=u[1],l=n-i.length;return`${t}${"0".repeat(l)}`}function appendSuffix(t,n){return typeof n>"u"?t:t===EMPTY_STRING$1?EMPTY_STRING$1:`${t}${n}`}const FRACTION_DIGITS=3,EMPTY_STRING="",RawTextboxNumeric=createComponent(function({disabled:t=!1,incrementBig:n=10,incrementSmall:u=1,integer:i=!1,maximum:l,minimum:f,onBlur:S=noop,onFocus:M=noop,onInput:V=noop,onMouseDown:h=noop,onKeyDown:w=noop,onNumericValueInput:b=noop,onValueInput:D=noop,placeholder:$,propagateEscapeKeyDown:G=!0,revertOnEscapeKeyDown:_=!1,suffix:c,validateOnBlur:I,value:r,...C},E){if(typeof f<"u"&&typeof l<"u"&&f>=l)throw new Error("`minimum` must be less than `maximum`");const P=F(null),N=F(!1),[g,d]=p(EMPTY_STRING),s=x(function(e){const a=getCurrentFromRef(P);a.value=e;const o=new window.Event("input",{bubbles:!0,cancelable:!0});a.dispatchEvent(o)},[]),O=x(function(e){if(S(e),N.current===!0){N.current=!1;return}if(typeof I<"u"){const a=evaluateValue(r,c),o=I(a);if(typeof o=="number"){s(formatEvaluatedValue(o,r,c)),d(EMPTY_STRING);return}if(o===null){s(EMPTY_STRING),d(EMPTY_STRING);return}if(o===!1){r!==g&&s(g),d(EMPTY_STRING);return}}if(typeof c<"u"&&r===c){s(EMPTY_STRING),d(EMPTY_STRING);return}if(r!==EMPTY_STRING&&r!==MIXED_STRING){const a=evaluateValue(r,c),o=formatEvaluatedValue(a,r,c);r!==o&&s(o)}d(EMPTY_STRING)},[S,g,s,c,I,r]),X=x(function(e){M(e),d(r),e.currentTarget.select()},[M,r]),k=x(function(e){V(e);const a=e.currentTarget.value;D(a);const o=evaluateValue(a,c);b(o)},[V,b,D,c]),A=x(function(e){w(e);const a=e.key;if(a==="Escape"){_===!0&&(N.current=!0,s(g),d(EMPTY_STRING)),G===!1&&e.stopPropagation(),e.currentTarget.blur();return}const o=e.currentTarget;if(a==="ArrowDown"||a==="ArrowUp"){const T=e.shiftKey===!0?n:u;if(e.preventDefault(),r===EMPTY_STRING||r===MIXED_STRING){const B=function(){return typeof f<"u"&&f>0?f:typeof l<"u"&&l<0?l:0}(),H=evaluateValueWithDelta(B,a==="ArrowDown"?-1*T:T),J=restrictValue(H,f,l),L=formatEvaluatedValue(J,r,c);o.value=L,o.select();const Q=new window.Event("input",{bubbles:!0,cancelable:!0});o.dispatchEvent(Q);return}const R=evaluateValue(r,c);if(R===null)throw new Error("`number` is `null`");const j=evaluateValueWithDelta(R,a==="ArrowDown"?-1*T:T),q=restrictValue(j,f,l),Y=formatEvaluatedValue(q,r,c);if(Y===r)return;o.value=Y,o.select();const z=new window.Event("input",{bubbles:!0,cancelable:!0});o.dispatchEvent(z);return}if(!(e.ctrlKey===!0||e.metaKey===!0)&&isKeyCodeCharacterGenerating(e.keyCode)===!0){const T=trimSuffix(r===MIXED_STRING?e.key:computeNextValue(o,e.key),c);if(isValidNumericInput(T,{integersOnly:i})===!1){e.preventDefault();return}if(typeof f>"u"&&typeof l>"u")return;const R=evaluateNumericExpression(T);if(R===null)return;(typeof f<"u"&&R<f||typeof l<"u"&&R>l)&&e.preventDefault()}},[n,u,i,l,f,w,g,G,_,s,c,r]),K=x(function(e){h(e),r===MIXED_STRING&&(e.preventDefault(),e.currentTarget.select())},[h,r]),U=x(function(e){if(e.clipboardData===null)throw new Error("`event.clipboardData` is `null`");const a=trimSuffix(computeNextValue(e.currentTarget,e.clipboardData.getData("Text")),c);isValidNumericInput(a,{integersOnly:i})===!1&&e.preventDefault()},[i,c]),W=x(function(e){if(P.current=e,E!==null){if(typeof E=="function"){E(e);return}E.current=e}},[E]);return y("input",{...C,ref:W,disabled:t===!0,onBlur:O,onFocus:X,onInput:k,onKeyDown:A,onMouseDown:K,onPaste:U,placeholder:$,spellcheck:!1,tabIndex:0,type:"text",value:r===MIXED_STRING?"Mixed":r})});function restrictValue(t,n,u){return typeof n<"u"?typeof u<"u"?Math.min(Math.max(t,n),u):Math.max(t,n):typeof u<"u"?Math.min(t,u):t}function evaluateValue(t,n){return t===MIXED_STRING?MIXED_NUMBER:t===EMPTY_STRING?null:evaluateNumericExpression(trimSuffix(t,n))}function evaluateValueWithDelta(t,n){return parseFloat((t+n).toFixed(FRACTION_DIGITS))}function trimSuffix(t,n){return typeof n>"u"?t:t.replace(new RegExp(`${n}$`),EMPTY_STRING)}export{RawTextboxNumeric as R};
